<!DOCTYPE html>

<html>
<head>
  <title>Robot finds kitten - Corona edition</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Robot finds kitten - Corona edition</h1>
<p>In robot finds kitten (rfk) a robot strikes out to find his lost kitten.
The goal is to travel the map searching obstacles for the kitten.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>The main game function.</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This function contains the entire code to start and run the game. We put
it all inside a function so that when the player finishes, they can start
over without closing and restarting the game.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">()</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Gather some information about the current screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="keyword">local</span> screenWidth = display.contentWidth
    <span class="keyword">local</span> screenHeight = display.contentHeight</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>We want to make the main map as big as possible, but we need to
have room for controls on the left side, so we&#39;ll portion out one
sixth (1 / 6) of the screen width for the controller.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> controllerWidth = screenWidth / <span class="number">6</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>We also want to leave a bit of room on the right side so the map doesn&#39;t
touch the edge of the screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> rightMargin = <span class="number">30</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3>Build the map grid.</h3>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Games need a field of play. One type of field is a two-dimensional grid.
It&#39;s like taking graph paper and laying it over a section of your screen
then you allow your game pieces to move between the grid squares based
on the rules of the game. Chess and Checkers are board games that work
this way. The Legend of Zelda (on old Nintendo) is a video game that
works this way and there are lots of others. Can you think of a few?</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>We want to make a grid. To do this in Lua we‘ll use an object. Let’s
start with an empty one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> grid = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Grids can be described by the number of squares across as well as the
number of squares up and down. We call the squares from left to right
&quot;the <em>x</em> direction and squares up and down the <em>y</em> direction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.xSquares = <span class="number">10</span>
    grid.ySquares = <span class="number">7</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>The total width of our grid is going to be the width of the screen
without the space taken up by the controller and without the space we
decided to leave for our margin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.totalWidth = screenWidth - controllerWidth - rightMargin</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Since we already decided how big our whole grid will be and how many
squares it will have, we can figure out how big our squares are using
basic algebra. The size of each square is equal to the width of the whole
map divided by the width of each square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.squareSize = grid.totalWidth / grid.xSquares</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>We&#39;re going to start our map at the edge of our controller. The last
pixel of our controller area is going to be the first pixel of our map
grid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.xStart = controllerWidth</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Just like we wanted to leave a bit of room along the right edge, we want
to leave some room on top of the screen. I found this to be a good
size but you can change it if you want.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.yStart = <span class="number">60</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Lastly, we want to create a group for all the grid tiles and objects on
our map so we can move them around all at once. This is going to help us
with positioning elements on screen later on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.displayGroup = display.newGroup()</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The map is going to be shown on screen with its (0, 0) being the
(xStart, yStart) of the total screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.displayGroup.x = grid.xStart
    grid.displayGroup.y = grid.yStart</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>So our players can see how big the map is, we want to fill the map area
with a background. We‘ll use a rounded rectangle. It’s a rectangular
shape with the corners rounded off so they&#39;re not as sharp. Just like
rounded edges make things easier to sit on, they also make things easier
to look at.</p>
<p>The rectangle belongs to our grid&#39;s display group and it starts at the
origin or (0, 0), which in computer grids is usually the top left corner
of the grid.</p>
<p>The width of the map is equal to the number of squares in the <em>x</em>
direction times the size of one square. The height is similarly the
number of squares in the <em>y</em> direction times the size of one square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.area = display.newRoundedRect(grid.displayGroup, <span class="number">0</span>, <span class="number">0</span>, grid.xSquares *
    grid.squareSize, grid.ySquares * grid.squareSize, <span class="number">50</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Let‘s make the grid a bright grey color so it’s easy to see.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grid.area:setFillColor(<span class="number">218</span>, <span class="number">218</span>, <span class="number">218</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3>Grid functions</h3>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>These functions will be placed on our grid squares. They&#39;ll help us find
adjacent squares when we need them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		grid.functions = {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This function looks for the square to the left of the current one. If
this square&#39;s <em>x</em> coordinate is 0, that means it must be the leftmost
square in that row, so we just say that the square to the left of this
one is the same as this one. Otherwise, we find the square in this same
row whose <em>x</em> coordinate is one less than our current square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      left = function(gridSquare)
        <span class="keyword">if</span> gridSquare.x == <span class="number">0</span> <span class="keyword">then</span>
          <span class="keyword">return</span> gridSquare
        <span class="keyword">else</span>
          <span class="keyword">return</span> grid[gridSquare.x - <span class="number">1</span>][gridSquare.y]
        <span class="keyword">end</span>
      <span class="keyword">end</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>When trying to find the square to the right, we need to watch out for
the rightmost square. Since we started counting squares at 0, the
rightmost square&#39;s <em>x</em> coordinate will be one less than the number of
grid squares in the <em>x</em> direction. So if the next square would be equal
to that number, we&#39;re at the end, and we give back the same square we
got, just like before otherwise, we return the square whose <em>x</em>
coordinate is one more than our current square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      right = function(gridSquare)
        <span class="keyword">if</span> gridSquare.x + <span class="number">1</span> == grid.xSquares <span class="keyword">then</span>
          <span class="keyword">return</span> gridSquare
        <span class="keyword">else</span>
          <span class="keyword">return</span> grid[gridSquare.x + <span class="number">1</span>][gridSquare.y]
        <span class="keyword">end</span>
      <span class="keyword">end</span>,

      up = function(gridSquare)
        <span class="keyword">if</span> gridSquare.y == <span class="number">0</span> <span class="keyword">then</span>
          <span class="keyword">return</span> gridSquare
        <span class="keyword">else</span>
          <span class="keyword">return</span> grid[gridSquare.x][gridSquare.y - <span class="number">1</span>]
        <span class="keyword">end</span>
      <span class="keyword">end</span>,

      down = function(gridSquare)
        <span class="keyword">if</span> gridSquare.y + <span class="number">1</span> == grid.ySquares <span class="keyword">then</span>
          <span class="keyword">return</span> gridSquare
        <span class="keyword">else</span>
          <span class="keyword">return</span> grid[gridSquare.x][gridSquare.y + <span class="number">1</span>]
        <span class="keyword">end</span>
      <span class="keyword">end</span>,
    }

    <span class="keyword">for</span> x = <span class="number">0</span>, <span class="number">9</span> <span class="keyword">do</span>
        grid[x] = {x = x} <span class="comment">-- Create grid row table.</span>
    
        <span class="keyword">for</span> y = <span class="number">0</span>, <span class="number">5</span> <span class="keyword">do</span>
            grid[x][y] = {x = x, y = y} <span class="comment">-- Create grid element.</span>
            <span class="keyword">local</span> rect = display.newRect(grid.displayGroup,
                grid.squareSize * x, grid.squareSize * y,
                grid.squareSize, grid.squareSize)
    
            rect:setFillColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)
            grid[x][y].displayObject = rect
            grid[x][y].left = grid.functions.left
            grid[x][y].right = grid.functions.right
            grid[x][y].above = grid.functions.up
            grid[x][y].below = grid.functions.down
        <span class="keyword">end</span>
    <span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>[[ Create the robot and kitten ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> robot = {}
    <span class="keyword">local</span> kitten = {}
    
    <span class="function"><span class="keyword">function</span> <span class="title">robot:enter</span><span class="params">(gridSquare)</span></span>
        <span class="keyword">local</span> newX = gridSquare.displayObject.x
        <span class="keyword">local</span> newY = gridSquare.displayObject.y
        <span class="keyword">if</span> self.displayObject == <span class="keyword">nil</span> <span class="keyword">then</span>
            self.displayObject = display.newImageRect(grid.displayGroup,
                <span class="string">"robot.png"</span>, grid.squareSize, grid.squareSize)
            self.displayObject.x = newX
            self.displayObject.y = newY
        <span class="keyword">else</span>
            self.displayObject.x = newX
            self.displayObject.y = newY
        <span class="keyword">end</span>
        self.gridSquare = gridSquare
        self.x = gridSquare.x
        self.y = gridSquare.y
    <span class="keyword">end</span>
    
    <span class="function"><span class="keyword">function</span> <span class="title">robot:canEnter</span><span class="params">(gridSquare)</span></span>
        <span class="keyword">return</span> gridSquare.obstacle == <span class="keyword">nil</span>
    <span class="keyword">end</span>
    
    robot:enter(grid[<span class="number">0</span>][<span class="number">0</span>]) <span class="comment">-- Put the robot in the first square.</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>[[ Display controls ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> controlCenterX = controllerWidth / <span class="number">2</span>
    <span class="keyword">local</span> controlCenterY = screenHeight - screenHeight / <span class="number">5</span>
    <span class="keyword">local</span> controlCenterRadius = controllerWidth / <span class="number">2</span> - rightMargin
    <span class="keyword">local</span> circlePad = display.newCircle(controlCenterX, controlCenterY, controlCenterRadius)
    circlePad:setFillColor(<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>)
    <span class="keyword">local</span> upDownWidth = <span class="number">27</span>
    <span class="keyword">local</span> upDownHeight = <span class="number">60</span>
    <span class="keyword">local</span> leftRightWidth = <span class="number">60</span>
    <span class="keyword">local</span> leftRightHeight = <span class="number">27</span>
    
    <span class="keyword">local</span> controls = {
        up    = {},
        down  = {},
        right = {},
        left  = {},
    }
    
    <span class="keyword">local</span> up = display.newImageRect(<span class="string">"arrow_up.png"</span>, upDownWidth, upDownHeight)
    up.x = controlCenterX
    up.y = controlCenterY - upDownHeight / <span class="number">2</span>
    controls.up.displayObject = up
    
    <span class="keyword">local</span> down = display.newImageRect(<span class="string">"arrow_down.png"</span>, upDownWidth, upDownHeight)
    down.x = controlCenterX
    down.y = controlCenterY + upDownHeight / <span class="number">2</span>
    controls.down.displayObject = down
    
    <span class="keyword">local</span> right = display.newImageRect(<span class="string">"arrow_right.png"</span>, leftRightWidth, leftRightHeight)
    right.x = controlCenterX + leftRightWidth / <span class="number">2</span>
    right.y = controlCenterY
    controls.right.displayObject = right
    
    <span class="keyword">local</span> left = display.newImageRect(<span class="string">"arrow_left.png"</span>, leftRightWidth, leftRightHeight)
    left.x = controlCenterX - leftRightWidth / <span class="number">2</span>
    left.y = controlCenterY
    controls.left.displayObject = left</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>[[ Display the saying ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    <span class="keyword">local</span> saying = {
        font = native.systemFont,
        x = <span class="number">100</span>, y = <span class="number">700</span>,
        fontSize = <span class="number">48</span>
    }
    
    <span class="function"><span class="keyword">function</span> <span class="title">saying:update</span><span class="params">(newText)</span></span>
        <span class="keyword">if</span> self.displayText == <span class="keyword">nil</span> <span class="keyword">then</span>
            self.displayText = display.newText(newText,
                self.x, self.y,
                self.font, self.fontSize)
        <span class="keyword">else</span>
            self.displayText.text = newText
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    saying:update(<span class="string">"Where is the kitten?"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>[[ Display obstacles ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> obstacles = {}
    
    <span class="function"><span class="keyword">function</span> <span class="title">obstacleHasKitten</span><span class="params">(obstacle)</span></span>
        <span class="keyword">return</span> obstacle.kitten == <span class="keyword">true</span>
    <span class="keyword">end</span>
    
    obstacles.rock = {
        image = <span class="string">"rock.png"</span>,
        saying = <span class="string">"There is no spoon.. or cat"</span>,
        hasKitten = obstacleHasKitten,
    }
    obstacles[<span class="number">0</span>] = obstacles.rock
    obstacles.trashcan = {
        image = <span class="string">"trash.png"</span>,
        saying = <span class="string">"Hmm. What was I looking for?"</span>,
        hasKitten = obstacleHasKitten,
    }
    obstacles[<span class="number">1</span>] = obstacles.trashcan
    obstacles.bush = {
        image = <span class="string">"bush.png"</span>,
        saying = <span class="string">"The sky is nice today."</span>,
        hasKitten = obstacleHasKitten,
    }
    obstacles[<span class="number">2</span>] = obstacles.bush
    
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">putObstacle</span><span class="params">(obstacle, gridSquare)</span></span>
        obstacle.x = gridSquare.x
        obstacle.y = gridSquare.y
        obstacle.displayObject = display.newImageRect(grid.displayGroup, obstacle.image,
            grid.squareSize, grid.squareSize)
        obstacle.displayObject.x = gridSquare.displayObject.x
        obstacle.displayObject.y = gridSquare.displayObject.y
        gridSquare.obstacle = obstacle
    <span class="keyword">end</span>
    
    putObstacle(obstacles.rock, grid[<span class="number">4</span>][<span class="number">1</span>])
    putObstacle(obstacles.bush, grid[<span class="number">6</span>][<span class="number">3</span>])
    putObstacle(obstacles.trashcan, grid[<span class="number">2</span>][<span class="number">5</span>])
    
    obstacles[<span class="built_in">math</span>.random(<span class="number">0</span>, <span class="number">2</span>)].kitten = <span class="keyword">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>[[ Make the robot move when controlled ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressLeft</span><span class="params">(event)</span></span>
        <span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
            <span class="keyword">local</span> nextSquare = robot.gridSquare:left()
            <span class="keyword">if</span> robot:canEnter(nextSquare) <span class="keyword">then</span>
                robot:enter(nextSquare)
            <span class="keyword">elseif</span> nextSquare.obstacle:hasKitten() <span class="keyword">then</span>
                robotfindskitten()
            <span class="keyword">else</span>
                saying:update(nextSquare.obstacle.saying)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressRight</span><span class="params">(event)</span></span>
        <span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
            <span class="keyword">local</span> nextSquare  = robot.gridSquare:right()
            <span class="keyword">if</span> robot:canEnter(nextSquare) <span class="keyword">then</span>
                robot:enter(nextSquare)
            <span class="keyword">elseif</span> nextSquare.obstacle:hasKitten() <span class="keyword">then</span>
                robotfindskitten()
            <span class="keyword">else</span>
                saying:update(nextSquare.obstacle.saying)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressUp</span><span class="params">(event)</span></span>
        <span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
            <span class="keyword">local</span> nextSquare  = robot.gridSquare:above()
            <span class="keyword">if</span> robot:canEnter(nextSquare) <span class="keyword">then</span>
                robot:enter(nextSquare)
            <span class="keyword">elseif</span> nextSquare.obstacle:hasKitten() <span class="keyword">then</span>
                robotfindskitten()
            <span class="keyword">else</span>
                saying:update(nextSquare.obstacle.saying)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">pressDown</span><span class="params">(event)</span></span>
        <span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
            <span class="keyword">local</span> nextSquare  = robot.gridSquare:below()
            <span class="keyword">if</span> robot:canEnter(nextSquare) <span class="keyword">then</span>
                robot:enter(nextSquare)
            <span class="keyword">elseif</span> nextSquare.obstacle:hasKitten() <span class="keyword">then</span>
                robotfindskitten()
            <span class="keyword">else</span>
                saying:update(nextSquare.obstacle.saying)
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    controls.left.displayObject:addEventListener(<span class="string">"touch"</span>, pressLeft)
    controls.right.displayObject:addEventListener(<span class="string">"touch"</span>, pressRight)
    controls.up.displayObject:addEventListener(<span class="string">"touch"</span>, pressUp)
    controls.down.displayObject:addEventListener(<span class="string">"touch"</span>, pressDown)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>[[ Robot finds kitten! ]]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    <span class="function"><span class="keyword">function</span> <span class="title">animatedReunion</span><span class="params">()</span></span>
        robot:enter(grid[robot.x + <span class="number">1</span>][robot.y])
        kitten:enter(grid[kitten.x - <span class="number">1</span>][kitten.y])
    <span class="keyword">end</span>
    
    <span class="keyword">local</span> playAgainButton
    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">showPlayAgain</span><span class="params">()</span></span>
        <span class="keyword">local</span> playAgainButton = display.newCircle(controlCenterX, controlCenterY, controlCenterRadius)
        playAgainButton.strokeWidth = <span class="number">6</span>
        playAgainButton:setStrokeColor(<span class="number">244</span>, <span class="number">244</span>, <span class="number">64</span>)
        <span class="keyword">local</span> playAgainText = display.newText(<span class="string">"Again"</span>, controlCenterX - controlCenterRadius + <span class="number">20</span>,
            controlCenterY - <span class="number">18</span>, native.systemFont, <span class="number">24</span>)
        playAgainText:setTextColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)

        <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">playAgainButtonActivate</span><span class="params">(event)</span></span>
            <span class="keyword">if</span> event.phase == <span class="string">"began"</span> <span class="keyword">then</span>
                display.remove(playAgainButton)
                display.remove(playAgainText)
                playAgainButton = <span class="keyword">nil</span>
                playAgainText = <span class="keyword">nil</span>
                play()
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        playAgainButton:addEventListener(<span class="string">"touch"</span>, playAgainButtonActivate)
    <span class="keyword">end</span>
    
    <span class="function"><span class="keyword">function</span> <span class="title">robotfindskitten</span><span class="params">()</span></span>
        <span class="keyword">for</span> i = <span class="number">0</span>, <span class="number">2</span> <span class="keyword">do</span>
            grid.displayGroup:remove(obstacles[i].displayObject)
            obstacles[i].displayObject = <span class="keyword">nil</span>
        <span class="keyword">end</span>
        robot.foundKitten = <span class="keyword">true</span>
        kitten.displayObject = display.newImageRect(grid.displayGroup, <span class="string">"kitten.png"</span>,
            grid.squareSize, grid.squareSize)
        kitten.enter = robot.enter
        kitten:enter(grid[<span class="number">9</span>][<span class="number">4</span>])
        
        display.remove(circlePad)
        circlePad = <span class="keyword">nil</span>
        display.remove(controls.up.displayObject)
        controls.up.displayObject = <span class="keyword">nil</span>
        display.remove(controls.down.displayObject)
        controls.down.displayObject = <span class="keyword">nil</span>
        display.remove(controls.left.displayObject)
        controls.left.displayObject = <span class="keyword">nil</span>
        display.remove(controls.right.displayObject)
        controls.right.displayObject = <span class="keyword">nil</span>
        robot:enter(grid[<span class="number">0</span>][<span class="number">4</span>])
        display.remove(saying.displayText)
        saying.displayText = <span class="keyword">nil</span>
        timer.performWithDelay(<span class="number">1000</span>, animatedReunion, <span class="number">4</span>)
        timer.performWithDelay(<span class="number">4000</span>, showPlayAgain, <span class="number">1</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>
play()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
